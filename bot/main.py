"""
–ö–†–û–ö 1: –ù–∞–π–ø—Ä–æ—Å—Ç—ñ—à–∏–π –º–æ–∂–ª–∏–≤–∏–π Telegram –±–æ—Ç

–©–æ —Ä–æ–±–∏—Ç—å —Ü–µ–π –±–æ—Ç:
- –ó–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è —ñ —á–µ–∫–∞—î –Ω–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
- –í—ñ–¥–ø–æ–≤—ñ–¥–∞—î –Ω–∞ –∫–æ–º–∞–Ω–¥—É /start

–©–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –¥–ª—è –∑–∞–ø—É—Å–∫—É:
1. –¢–æ–∫–µ–Ω –≤—ñ–¥ @BotFather
2. –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–π aiogram (–≤–∂–µ —î –≤ pyproject.toml)

–Ø–∫ –∑–∞–ø—É—Å—Ç–∏—Ç–∏:
    python -m bot.main

–ü–æ—è—Å–Ω–µ–Ω–Ω—è –∫–æ–¥—É:
- asyncio - –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è (–±–æ—Ç –ø—Ä–∞—Ü—é—î –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ)
- Bot - –∫–ª–∞—Å –¥–ª—è –≤–∑–∞—î–º–æ–¥—ñ—ó –∑ Telegram API
- Dispatcher - –æ–±—Ä–æ–±–ª—è—î –≤—Ö—ñ–¥–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
- CommandStart - —Ñ—ñ–ª—å—Ç—Ä –¥–ª—è –∫–æ–º–∞–Ω–¥–∏ /start
"""

import asyncio
from aiogram import Bot, Dispatcher
from aiogram.filters import CommandStart
from aiogram.types import Message


# ========================================
# –®–ê–ì 1.1: –¢–æ–∫–µ–Ω –±–æ—Ç–∞
# ========================================
# –í–ê–ñ–õ–ò–í–û: –í –Ω–∞—Å—Ç—É–ø–Ω–æ–º—É –∫—Ä–æ—Ü—ñ –≤–∏–Ω–µ—Å–µ–º–æ —Ü–µ –≤ .env —Ñ–∞–π–ª
# –ü–æ–∫–∏ —â–æ –ø—Ä–æ—Å—Ç–æ –≤—Å—Ç–∞–≤—Ç–µ —Ç–æ–∫–µ–Ω –≤—ñ–¥ @BotFather —Å—é–¥–∏
BOT_TOKEN = "YOUR_BOT_TOKEN_HERE"


# ========================================
# –®–ê–ì 1.2: –û–±—Ä–æ–±–Ω–∏–∫ –∫–æ–º–∞–Ω–¥–∏ /start
# ========================================
async def cmd_start(message: Message):
    """
    –§—É–Ω–∫—Ü—ñ—è, —è–∫–∞ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –∫–æ–ª–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î /start

    –ü–∞—Ä–∞–º–µ—Ç—Ä–∏:
    - message: –æ–±'—î–∫—Ç –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤—ñ–¥ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞

    –©–æ —Ä–æ–±–∏—Ç—å:
    - –û—Ç—Ä–∏–º—É—î —ñ–º'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (—è–∫—â–æ —î)
    - –í—ñ–¥–ø—Ä–∞–≤–ª—è—î –ø—Ä–∏–≤—ñ—Ç–∞–ª—å–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
    """
    # –û—Ç—Ä–∏–º—É—î–º–æ —ñ–º'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (–∞–±–æ "–¥—Ä—É–∂–µ" —è–∫—â–æ —ñ–º–µ–Ω—ñ –Ω–µ–º–∞—î)
    user_name = message.from_user.first_name or "–¥—Ä—É–∂–µ"

    # –§–æ—Ä–º—É—î–º–æ —Ç–µ–∫—Å—Ç –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
    text = f"–ü—Ä–∏–≤—ñ—Ç, {user_name}! üëã\n\n–Ø –ø—Ä–æ—Å—Ç–∏–π –±–æ—Ç. –ü–æ–∫–∏ —â–æ –≤–º—ñ—é —Ç—ñ–ª—å–∫–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—Ç–∏ –Ω–∞ /start"

    # –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É
    await message.answer(text)


# ========================================
# –®–ê–ì 1.3: –ì–æ–ª–æ–≤–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –∑–∞–ø—É—Å–∫—É
# ========================================
async def main():
    """
    –ì–æ–ª–æ–≤–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è, —è–∫–∞ –∑–∞–ø—É—Å–∫–∞—î –±–æ—Ç–∞

    –©–æ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è:
    1. –°—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –æ–±'—î–∫—Ç –±–æ—Ç–∞ –∑ —Ç–æ–∫–µ–Ω–æ–º
    2. –°—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –¥–∏—Å–ø–µ—Ç—á–µ—Ä (–æ–±—Ä–æ–±–Ω–∏–∫ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å)
    3. –†–µ—î—Å—Ç—Ä—É—î—Ç—å—Å—è –æ–±—Ä–æ–±–Ω–∏–∫ –¥–ª—è /start
    4. –ó–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è polling (–±–æ—Ç –ø–æ—Å—Ç—ñ–π–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—î –Ω–æ–≤—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è)
    """

    # –ö—Ä–æ–∫ 1: –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –±–æ—Ç–∞
    print("ü§ñ –°—Ç–≤–æ—Ä—é—é –±–æ—Ç–∞...")
    bot = Bot(token=BOT_TOKEN)

    # –ö—Ä–æ–∫ 2: –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞
    print("üì¶ –°—Ç–≤–æ—Ä—é—é –¥–∏—Å–ø–µ—Ç—á–µ—Ä...")
    dp = Dispatcher()

    # –ö—Ä–æ–∫ 3: –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –æ–±—Ä–æ–±–Ω–∏–∫–∞ /start
    print("üîß –†–µ—î—Å—Ç—Ä—É—é –æ–±—Ä–æ–±–Ω–∏–∫ /start...")
    dp.message.register(cmd_start, CommandStart())

    # –ö—Ä–æ–∫ 4: –í–∏–¥–∞–ª–µ–Ω–Ω—è webhook (—è–∫—â–æ –±—É–≤)
    print("üßπ –û—á–∏—â–∞—é webhook...")
    await bot.delete_webhook(drop_pending_updates=True)

    # –ö—Ä–æ–∫ 5: –û—Ç—Ä–∏–º–∞–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ –±–æ—Ç–∞
    me = await bot.get_me()
    print(f"‚úÖ –ë–æ—Ç @{me.username} —É—Å–ø—ñ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω–æ!")
    print(f"üì° –û—á—ñ–∫—É—é –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è...\n")

    # –ö—Ä–æ–∫ 6: –ó–∞–ø—É—Å–∫ polling (–Ω–µ—Å–∫—ñ–Ω—á–µ–Ω–Ω–∏–π —Ü–∏–∫–ª –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å)
    try:
        await dp.start_polling(bot)
    except KeyboardInterrupt:
        print("\n‚ö†Ô∏è –û—Ç—Ä–∏–º–∞–Ω–æ —Å–∏–≥–Ω–∞–ª –∑—É–ø–∏–Ω–∫–∏...")
    finally:
        # –ó–∞–∫—Ä–∏–≤–∞—î–º–æ —Å–µ—Å—ñ—é –±–æ—Ç–∞
        await bot.session.close()
        print("üëã –ë–æ—Ç –∑—É–ø–∏–Ω–µ–Ω–æ!")


# ========================================
# –®–ê–ì 1.4: –¢–æ—á–∫–∞ –≤—Ö–æ–¥—É
# ========================================
if __name__ == "__main__":
    """
    –¶—è —á–∞—Å—Ç–∏–Ω–∞ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –∫–æ–ª–∏ –º–∏ –∑–∞–ø—É—Å–∫–∞—î–º–æ —Ñ–∞–π–ª –Ω–∞–ø—Ä—è–º—É

    asyncio.run(main()) - –∑–∞–ø—É—Å–∫–∞—î –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É —Ñ—É–Ω–∫—Ü—ñ—é main()
    """
    print("=" * 50)
    print("üåæ FERM BOT - –ö–†–û–ö 1: –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π –±–æ—Ç")
    print("=" * 50)
    print()

    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞
    if BOT_TOKEN == "YOUR_BOT_TOKEN_HERE":
        print("‚ùå –ü–û–ú–ò–õ–ö–ê: –í—Å—Ç–∞–≤—Ç–µ —Ç–æ–∫–µ–Ω –≤—ñ–¥ @BotFather —É –∑–º—ñ–Ω–Ω—É BOT_TOKEN")
        print("üìù –í—ñ–¥–∫—Ä–∏–π—Ç–µ bot/main.py —Ç–∞ –∑–Ω–∞–π–¥—ñ—Ç—å —Ä—è–¥–æ–∫:")
        print('   BOT_TOKEN = "YOUR_BOT_TOKEN_HERE"')
        print()
        print("üìå –Ø–∫ –æ—Ç—Ä–∏–º–∞—Ç–∏ —Ç–æ–∫–µ–Ω:")
        print("   1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ Telegram")
        print("   2. –ó–Ω–∞–π–¥—ñ—Ç—å @BotFather")
        print("   3. –í—ñ–¥–ø—Ä–∞–≤—Ç–µ /newbot")
        print("   4. –°–ª—ñ–¥—É–π—Ç–µ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è–º")
        print("   5. –°–∫–æ–ø—ñ—é–π—Ç–µ —Ç–æ–∫–µ–Ω —ñ –≤—Å—Ç–∞–≤—Ç–µ —É —Ñ–∞–π–ª")
        exit(1)

    # –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
    try:
        asyncio.run(main())
    except Exception as e:
        print(f"üí• –ö—Ä–∏—Ç–∏—á–Ω–∞ –ø–æ–º–∏–ª–∫–∞: {e}")
        exit(1)
