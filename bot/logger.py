"""
–ö–†–û–ö 3: –õ–æ–≥—É–≤–∞–Ω–Ω—è —á–µ—Ä–µ–∑ loguru

–©–æ —Ç–∞–∫–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è?
- –ó–∞–ø–∏—Å –ø–æ–¥—ñ–π —â–æ –≤—ñ–¥–±—É–≤–∞—é—Ç—å—Å—è –≤ –ø—Ä–æ–≥—Ä–∞–º—ñ
- –î–æ–ø–æ–º–∞–≥–∞—î –≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞—Ç–∏ —Ä–æ–±–æ—Ç—É —Ç–∞ –∑–Ω–∞—Ö–æ–¥–∏—Ç–∏ –ø–æ–º–∏–ª–∫–∏
- –ö—Ä–∞—â–µ –Ω—ñ–∂ print() –±–æ –º–æ–∂–Ω–∞ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ –≤ —Ñ–∞–π–ª–∏

–©–æ —Ç–∞–∫–µ loguru?
- –ë—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ –¥–ª—è –ª–æ–≥—É–≤–∞–Ω–Ω—è –≤ Python
- –î—É–∂–µ –ø—Ä–æ—Å—Ç–∞ —É –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—ñ (–ø—Ä–æ—Å—Ç—ñ—à–µ –Ω—ñ–∂ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π logging)
- –ö—Ä–∞—Å–∏–≤—ñ –∫–æ–ª—å–æ—Ä–æ–≤—ñ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª—ñ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ —Ä–æ—Ç–∞—Ü—ñ—è —Ñ–∞–π–ª—ñ–≤ (–Ω–µ —Ä–æ–∑—Ä–æ—Å—Ç–∞—é—Ç—å—Å—è –¥–æ –Ω–µ—Å–∫—ñ–Ω—á–µ–Ω–Ω–æ—Å—Ç—ñ)

–†—ñ–≤–Ω—ñ –ª–æ–≥—É–≤–∞–Ω–Ω—è (–≤—ñ–¥ –Ω–∞–π–º–µ–Ω—à –¥–æ –Ω–∞–π–±—ñ–ª—å—à –≤–∞–∂–ª–∏–≤–∏—Ö):
- DEBUG: –î–µ—Ç–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –¥–ª—è –≤—ñ–¥–ª–∞–¥–∫–∏ (–±–∞–≥–∞—Ç–æ —Ç–µ–∫—Å—Ç—É!)
- INFO: –ó–∞–≥–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ —Ä–æ–±–æ—Ç—É (–Ω–æ—Ä–º–∞)
- WARNING: –ü–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è (—â–æ—Å—å –Ω–µ–∑–≤–∏—á–Ω–µ, –∞–ª–µ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–µ)
- ERROR: –ü–æ–º–∏–ª–∫–∞ (—â–æ—Å—å –ø—ñ—à–ª–æ –Ω–µ —Ç–∞–∫)
- CRITICAL: –ö—Ä–∏—Ç–∏—á–Ω–∞ –ø–æ–º–∏–ª–∫–∞ (–ø—Ä–æ–≥—Ä–∞–º–∞ –Ω–µ –º–æ–∂–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏)

–ü—Ä–∏–∫–ª–∞–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:
    from bot.logger import logger

    logger.debug("–î–µ—Ç–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –¥–ª—è —Ä–æ–∑—Ä–æ–±–Ω–∏–∫–∞")
    logger.info("–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω–æ —É—Å–ø—ñ—à–Ω–æ")
    logger.warning("–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤–≤—ñ–≤ –Ω–µ–∫–æ—Ä–µ–∫—Ç–Ω—ñ –¥–∞–Ω—ñ")
    logger.error("–ù–µ –≤–¥–∞–ª–æ—Å—è –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—å –¥–æ –ë–î")
    logger.critical("–ö—Ä–∏—Ç–∏—á–Ω–∞ –ø–æ–º–∏–ª–∫–∞, –±–æ—Ç –∑—É–ø–∏–Ω—è—î—Ç—å—Å—è")
"""

import sys
from pathlib import Path
from loguru import logger

from bot.config import settings, PROJECT_ROOT


# ========================================
# –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø LOGURU
# ========================================

def setup_logger():
    """
    –ù–∞–ª–∞—à—Ç–æ–≤—É—î –ª–æ–≥–µ—Ä –∑ –¥–≤–æ–º–∞ –≤–∏—Ö–æ–¥–∞–º–∏:
    1. –ö–æ–Ω—Å–æ–ª—å (stderr) - –∫–æ–ª—å–æ—Ä–æ–≤—ñ –ª–æ–≥–∏ –¥–ª—è —Ä–æ–∑—Ä–æ–±–Ω–∏–∫–∞
    2. –§–∞–π–ª logs/bot.log - –≤—Å—ñ –ª–æ–≥–∏ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É

    –©–æ —Ä–æ–±–∏—Ç—å —Ü—è —Ñ—É–Ω–∫—Ü—ñ—è:
    - –í–∏–¥–∞–ª—è—î —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ –æ–±—Ä–æ–±–Ω–∏–∫–∏ loguru
    - –î–æ–¥–∞—î –Ω–æ–≤–∏–π –æ–±—Ä–æ–±–Ω–∏–∫ –¥–ª—è –∫–æ–Ω—Å–æ–ª—ñ (–∑ –∫–æ–ª—å–æ—Ä–∞–º–∏)
    - –î–æ–¥–∞—î –æ–±—Ä–æ–±–Ω–∏–∫ –¥–ª—è —Ñ–∞–π–ª—É (–∑ —Ä–æ—Ç–∞—Ü—ñ—î—é)
    """

    # ========================================
    # –®–ê–ì 1: –û—á–∏—â–∞—î–º–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ –æ–±—Ä–æ–±–Ω–∏–∫–∏
    # ========================================
    # loguru –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –≤–∏–≤–æ–¥–∏—Ç—å –≤ stderr
    # –ú–∏ –≤–∏–¥–∞–ª—è—î–º–æ —Ü–µ —â–æ–± –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –ø–æ-—Å–≤–æ—î–º—É
    logger.remove()

    # ========================================
    # –®–ê–ì 2: –î–æ–¥–∞—î–º–æ –≤–∏–≤—ñ–¥ –≤ –ö–û–ù–°–û–õ–¨
    # ========================================
    logger.add(
        # –ö—É–¥–∏ –≤–∏–≤–æ–¥–∏—Ç–∏
        sys.stderr,

        # –§–æ—Ä–º–∞—Ç –ª–æ–≥—ñ–≤
        # <green>{time:YYYY-MM-DD HH:mm:ss}</green> - –∑–µ–ª–µ–Ω–∏–π —á–∞—Å
        # <level>{level: <8}</level> - —Ä—ñ–≤–µ–Ω—å –ª–æ–≥—É (INFO, ERROR —Ç–æ—â–æ)
        # <cyan>{name}</cyan>:<cyan>{function}</cyan> - —ñ–º'—è —Ñ–∞–π–ª—É —Ç–∞ —Ñ—É–Ω–∫—Ü—ñ—ó
        # <level>{message}</level> - —Å–∞–º–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
        format=(
            "<green>{time:YYYY-MM-DD HH:mm:ss}</green> | "
            "<level>{level: <8}</level> | "
            "<cyan>{name}</cyan>:<cyan>{function}</cyan>:<cyan>{line}</cyan> - "
            "<level>{message}</level>"
        ),

        # –†—ñ–≤–µ–Ω—å –ª–æ–≥—É–≤–∞–Ω–Ω—è –∑ .env
        level=settings.LOG_LEVEL,

        # –ö–æ–ª—å–æ—Ä–æ–≤—ñ –ª–æ–≥–∏ (True - —É–≤—ñ–º–∫–Ω–µ–Ω–æ)
        colorize=True,
    )

    # ========================================
    # –®–ê–ì 3: –î–æ–¥–∞—î–º–æ –≤–∏–≤—ñ–¥ —É –§–ê–ô–õ (—è–∫—â–æ —É–≤—ñ–º–∫–Ω–µ–Ω–æ)
    # ========================================
    if settings.LOG_TO_FILE:
        # –°—Ç–≤–æ—Ä—é—î–º–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—é –¥–ª—è –ª–æ–≥—ñ–≤ —è–∫—â–æ —ó—ó –Ω–µ–º–∞—î
        logs_dir = PROJECT_ROOT / "logs"
        logs_dir.mkdir(exist_ok=True)  # exist_ok=True - –Ω–µ –ø–∞–¥–∞—Ç–∏ —è–∫—â–æ –≤–∂–µ —î

        logger.add(
            # –ö—É–¥–∏ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏
            logs_dir / "bot.log",

            # –§–æ—Ä–º–∞—Ç (–±–µ–∑ –∫–æ–ª—å–æ—Ä—ñ–≤ –¥–ª—è —Ñ–∞–π–ª—É)
            format=(
                "{time:YYYY-MM-DD HH:mm:ss} | "
                "{level: <8} | "
                "{name}:{function}:{line} - "
                "{message}"
            ),

            # –†—ñ–≤–µ–Ω—å –ª–æ–≥—É–≤–∞–Ω–Ω—è
            level=settings.LOG_LEVEL,

            # –†–æ—Ç–∞—Ü—ñ—è —Ñ–∞–π–ª—ñ–≤ (—Å—Ç–≤–æ—Ä—é—î –Ω–æ–≤–∏–π —Ñ–∞–π–ª –∫–æ–ª–∏ —Å—Ç–∞—Ä–∏–π –¥–æ—Å—è–≥–Ω–µ —Ä–æ–∑–º—ñ—Ä—É)
            # "10 MB" - –Ω–æ–≤–∏–π —Ñ–∞–π–ª –∫–æ–∂–Ω—ñ 10 –º–µ–≥–∞–±–∞–π—Ç
            # –ú–æ–∂–Ω–∞ —Ç–∞–∫–æ–∂: "1 day" (–Ω–æ–≤–∏–π —Ñ–∞–π–ª —â–æ–¥–Ω—è), "1 week" —Ç–æ—â–æ
            rotation="10 MB",

            # –°–∫—ñ–ª—å–∫–∏ —Å—Ç–∞—Ä–∏—Ö —Ñ–∞–π–ª—ñ–≤ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏
            # retention="1 week" - –≤–∏–¥–∞–ª—è—Ç–∏ —Ñ–∞–π–ª–∏ —Å—Ç–∞—Ä—à—ñ –∑–∞ —Ç–∏–∂–¥–µ–Ω—å
            retention="1 week",

            # –°—Ç–∏—Å–∫–∞—Ç–∏ —Å—Ç–∞—Ä—ñ —Ñ–∞–π–ª–∏ (–µ–∫–æ–Ω–æ–º–∏—Ç—å –º—ñ—Å—Ü–µ)
            compression="zip",

            # –ö–æ–¥—É–≤–∞–Ω–Ω—è UTF-8 (–¥–ª—è –∫–∏—Ä–∏–ª–∏—Ü—ñ)
            encoding="utf-8",
        )

        logger.info(f"üìÅ –õ–æ–≥–∏ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤: {logs_dir / 'bot.log'}")

    # ========================================
    # –®–ê–ì 4: –õ–æ–≥—É—î–º–æ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
    # ========================================
    logger.info(f"üîß –õ–æ–≥–µ—Ä –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ | –†—ñ–≤–µ–Ω—å: {settings.LOG_LEVEL}")

    if settings.DEBUG:
        logger.warning("‚ö†Ô∏è  DEBUG —Ä–µ–∂–∏–º —É–≤—ñ–º–∫–Ω–µ–Ω–æ!")


# ========================================
# –ê–í–¢–û–ú–ê–¢–ò–ß–ù–ï –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø –ü–†–ò –Ü–ú–ü–û–†–¢–Ü
# ========================================
# –ö–æ–ª–∏ —Ö—Ç–æ—Å—å —Ä–æ–±–∏—Ç—å "from bot.logger import logger"
# –õ–æ–≥–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –Ω–∞–ª–∞—à—Ç—É—î—Ç—å—Å—è
setup_logger()


# ========================================
# –ü–†–ò–ö–õ–ê–î–ò –í–ò–ö–û–†–ò–°–¢–ê–ù–ù–Ø
# ========================================
"""
–í —ñ–Ω—à–∏—Ö —Ñ–∞–π–ª–∞—Ö –ø—Ä–æ—Å—Ç–æ —ñ–º–ø–æ—Ä—Ç—É–π—Ç–µ logger:

    from bot.logger import logger

    # –†—ñ–∑–Ω—ñ —Ä—ñ–≤–Ω—ñ –ª–æ–≥—É–≤–∞–Ω–Ω—è:
    logger.debug("–¶–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–ª—è –≤—ñ–¥–ª–∞–¥–∫–∏")
    logger.info("–¶–µ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ–π–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è")
    logger.warning("–¶–µ –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è")
    logger.error("–¶–µ –ø–æ–º–∏–ª–∫–∞")
    logger.critical("–¶–µ –∫—Ä–∏—Ç–∏—á–Ω–∞ –ø–æ–º–∏–ª–∫–∞")

    # –õ–æ–≥—É–≤–∞–Ω–Ω—è –∑ –∑–º—ñ–Ω–Ω–∏–º–∏:
    user_id = 12345
    logger.info(f"–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á {user_id} –∑–∞–ø—É—Å—Ç–∏–≤ –±–æ—Ç–∞")

    # –õ–æ–≥—É–≤–∞–Ω–Ω—è –ø–æ–º–∏–ª–æ–∫ –∑ traceback:
    try:
        result = 10 / 0
    except Exception as e:
        logger.exception("–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –¥—ñ–ª–µ–Ω–Ω—ñ:")  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –¥–æ–¥–∞—Å—Ç—å traceback

–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —á–µ—Ä–µ–∑ .env:
    # –†—ñ–≤–µ–Ω—å –ª–æ–≥—É–≤–∞–Ω–Ω—è (DEBUG, INFO, WARNING, ERROR, CRITICAL)
    LOG_LEVEL=INFO

    # –ó–±–µ—Ä—ñ–≥–∞—Ç–∏ –ª–æ–≥–∏ —É —Ñ–∞–π–ª? (True/False)
    LOG_TO_FILE=True

    # –†–µ–∂–∏–º –≤—ñ–¥–ª–∞–¥–∫–∏ (–±—ñ–ª—å—à–µ –ª–æ–≥—ñ–≤)
    DEBUG=False

–ü–µ—Ä–µ–≤–∞–≥–∏ loguru –ø–µ—Ä–µ–¥ print():
‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤ —Ñ–∞–π–ª–∏
‚úÖ –ö–æ–ª—å–æ—Ä–æ–≤—ñ –ª–æ–≥–∏ (–ª–µ–≥–∫–æ –ø–æ–º—ñ—Ç–∏—Ç–∏ –ø–æ–º–∏–ª–∫–∏)
‚úÖ –ß–∞—Å –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
‚úÖ –Ü–º'—è —Ñ–∞–π–ª—É —Ç–∞ –Ω–æ–º–µ—Ä —Ä—è–¥–∫–∞
‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ —Ä–æ—Ç–∞—Ü—ñ—è (—Ñ–∞–π–ª–∏ –Ω–µ —Ä–æ—Å—Ç—É—Ç—å –Ω–µ—Å–∫—ñ–Ω—á–µ–Ω–Ω–æ)
‚úÖ –†—ñ–∑–Ω—ñ —Ä—ñ–≤–Ω—ñ –≤–∞–∂–ª–∏–≤–æ—Å—Ç—ñ
‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π traceback –¥–ª—è –ø–æ–º–∏–ª–æ–∫
"""
